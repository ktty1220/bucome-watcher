var __DEBUG__ = false;
/* _nicedate.js */
_.mixin({niceDate:function(e,t){var n,a,T,E,A,D,r,i,N,O,M;return A=1e3,T=60*A,a=60*T,n=24*a,D=7*n,E=31*n,r=365*n,O={en:{AGO:" ago",AFTER:" after",SECOND:" second",MINUTE:" minute",HOUR:" hour",DAY:" day",WEEK:" week",MONTH:" month",YEAR:" year",PLURAL:"s"},ja:{AGO:"前",AFTER:"後",SECOND:"秒",MINUTE:"分",HOUR:"時間",DAY:"日",WEEK:"週",MONTH:"月",YEAR:"年"}},i={en:{HOUR_MINUTE:"%_:%_",MONTH_DATE:"%_.%_",YEAR_MONTH_DATE:"%_.%_.%_"},ja:{HOUR_MINUTE:"%_:%_",MONTH_DATE:["%_",O.ja.MONTH,"%_",O.ja.DAY].join(""),YEAR_MONTH_DATE:["%_",O.ja.YEAR,"%_",O.ja.MONTH,"%_",O.ja.DAY].join("")}},M=function(e,t,n){return e=Math.floor(e),n.PLURAL&&e>1?e+t+n.PLURAL:e+t},N=function(){var e,t,n,a,_;for(e=arguments[0],n=2<=arguments.length?__slice.call(arguments,1):[],a=0,_=n.length;_>a;a++)t=n[a],e=e.replace("%_",t);return e},function(e,E){var D,m,d,o;return(_.isString(e)||_.isNumber(e))&&(newDate=new Date(e),isNaN(newDate)&&(ymd=e.match(/^(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+)/),newDate=ymd?new Date(ymd[1]+"/"+ymd[2]+"/"+ymd[3]+" "+ymd[4]+":"+ymd[5]+":"+ymd[6]):e),e=newDate),_.isDate(e)?(o=(new Date).getTime(),E=_.isString(E)&&O[E]?E:"ja",t=O[E],d=i[E],m=o-e.getTime(),D=m>0?t.AGO:t.AFTER,m=Math.abs(m),T>m?""+M(m/A,t.SECOND,t)+D:a>m?""+M(m/T,t.MINUTE,t)+D:n>m?""+M(m/a,t.HOUR,t)+D:3*n>m?""+M(m/n,t.DAY,t)+D:r>m?""+N(d.MONTH_DATE,e.getMonth()+1,e.getDate()):""+N(d.MONTH_DATE,e.getMonth()+1,e.getDate())):void 0}}()});
/* activity-indicator.js */
!function(t){function e(e,i){var n=document.createElementNS("http://www.w3.org/2000/svg",e||"svg");return i&&t.each(i,function(t,e){n.setAttributeNS(null,t,e)}),t(n)}t.fn.activity=function(e){return this.each(function(){var a=t(this),o=a.data("activity");if(o&&(clearInterval(o.data("interval")),o.remove(),a.removeData("activity")),e!==!1){e=t.extend({color:a.css("color")},t.fn.activity.defaults,e),o=i(a,e).css("position","absolute").prependTo(e.outside?"body":a);var r=a.outerHeight()-o.height(),s=a.outerWidth()-o.width(),d={top:"top"==e.valign?e.padding:"bottom"==e.valign?r-e.padding:Math.floor(r/2),left:"left"==e.align?e.padding:"right"==e.align?s-e.padding:Math.floor(s/2)},c=a.offset();e.outside?o.css({top:c.top+"px",left:c.left+"px"}):(d.top-=o.offset().top-c.top,d.left-=o.offset().left-c.left),o.css({marginTop:d.top+"px",marginLeft:d.left+"px"}),n(o,e.segments,Math.round(10/e.speed)/10),a.data("activity",o)}}),this},t.fn.activity.defaults={segments:12,space:3,length:7,width:4,speed:1.2,align:"center",valign:"center",padding:4},t.fn.activity.getOpacity=function(t,e){var i=t.steps||t.segments-1,n=void 0!==t.opacity?t.opacity:1/i;return 1-Math.min(e,i)*(1-n)/i};var i=function(){return t("<div>").addClass("busy")},n=function(){};if(document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)if(i=function(i,n){for(var a=2*n.width+n.space,o=a+n.length+Math.ceil(n.width/2)+1,r=e().width(2*o).height(2*o),s=e("g",{"stroke-width":n.width,"stroke-linecap":"round",stroke:n.color}).appendTo(e("g",{transform:"translate("+o+","+o+")"}).appendTo(r)),d=0;d<n.segments;d++)s.append(e("line",{x1:0,y1:a,x2:0,y2:a+n.length,transform:"rotate("+360/n.segments*d+", 0, 0)",opacity:t.fn.activity.getOpacity(n,d)}));return t("<div>").append(r).width(2*o).height(2*o)},void 0!==document.createElement("div").style.WebkitAnimationName){var a={};n=function(e,i,n){if(!a[i]){for(var o="spin"+i,r="@-webkit-keyframes "+o+" {",s=0;i>s;s++){var d=Math.round(1e5/i*s)/1e3,c=Math.round(1e5/i*(s+1)-1)/1e3,l="% { -webkit-transform:rotate("+Math.round(360/i*s)+"deg); }\n";r+=d+l+c+l}r+="100% { -webkit-transform:rotate(100deg); }\n}",t("head").append(t('<style type="text/css">'+r+"</style>")),a[i]=o}e.css("-webkit-animation",a[i]+" "+n+"s linear infinite")}}else n=function(t,e,i){var n=0,a=t.find("g g").get(0);t.data("interval",setInterval(function(){a.setAttributeNS(null,"transform","rotate("+ ++n%e*(360/e)+")")},1e3*i/e))};else{var o=t("<shape>").css("behavior","url(#default#VML)");if(t("body").append(o),o.get(0).adj){var r=document.createStyleSheet();t.each(["group","shape","stroke"],function(){r.addRule(this,"behavior:url(#default#VML);")}),i=function(e,i){for(var n=2*i.width+i.space,a=n+i.length+Math.ceil(i.width/2)+1,o=2*a,r=-Math.ceil(o/2),s=t("<group>",{coordsize:o+" "+o,coordorigin:r+" "+r}).css({top:r,left:r,width:o,height:o}),d=0;d<i.segments;d++)s.append(t("<shape>",{path:"m "+n+",0  l "+(n+i.length)+",0"}).css({width:o,height:o,rotation:360/i.segments*d+"deg"}).append(t("<stroke>",{color:i.color,weight:i.width+"px",endcap:"round",opacity:t.fn.activity.getOpacity(i,d)})));return t("<group>",{coordsize:o+" "+o}).css({width:o,height:o,overflow:"hidden"}).append(s)},n=function(t,e,i){var n=0,a=t.get(0);t.data("interval",setInterval(function(){a.style.rotation=++n%e*(360/e)},1e3*i/e))}}t(o).remove()}}(jQuery);
/* jquery.powertip.js */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){var t=this;t.top="auto",t.left="auto",t.right="auto",t.bottom="auto",t.set=function(o,n){e.isNumeric(n)&&(t[o]=Math.round(n))}}function o(e,t,o){function n(n,i){r(),e.data(v)||(n?(i&&e.data(m,!0),o.showTip(e)):(P.tipOpenImminent=!0,l=setTimeout(function(){l=null,s()},t.intentPollInterval)))}function i(n){r(),P.tipOpenImminent=!1,e.data(v)&&(e.data(m,!1),n?o.hideTip(e):(P.delayInProgress=!0,l=setTimeout(function(){l=null,o.hideTip(e),P.delayInProgress=!1},t.closeDelay)))}function s(){var i=Math.abs(P.previousX-P.currentX),s=Math.abs(P.previousY-P.currentY),r=i+s;r<t.intentSensitivity?o.showTip(e):(P.previousX=P.currentX,P.previousY=P.currentY,n())}function r(){l=clearTimeout(l),P.delayInProgress=!1}function a(){o.resetPosition(e)}var l=null;this.show=n,this.hide=i,this.cancel=r,this.resetPosition=a}function n(){function e(e,i,r,a,l){var p,c=i.split("-")[0],u=new t;switch(p=s(e)?n(e,c):o(e,c),i){case"n":u.set("left",p.left-r/2),u.set("bottom",P.windowHeight-p.top+l);break;case"e":u.set("left",p.left+l),u.set("top",p.top-a/2);break;case"s":u.set("left",p.left-r/2),u.set("top",p.top+l);break;case"w":u.set("top",p.top-a/2),u.set("right",P.windowWidth-p.left+l);break;case"nw":u.set("bottom",P.windowHeight-p.top+l),u.set("right",P.windowWidth-p.left-20);break;case"nw-alt":u.set("left",p.left),u.set("bottom",P.windowHeight-p.top+l);break;case"ne":u.set("left",p.left-20),u.set("bottom",P.windowHeight-p.top+l);break;case"ne-alt":u.set("bottom",P.windowHeight-p.top+l),u.set("right",P.windowWidth-p.left);break;case"sw":u.set("top",p.top+l),u.set("right",P.windowWidth-p.left-20);break;case"sw-alt":u.set("left",p.left),u.set("top",p.top+l);break;case"se":u.set("left",p.left-20),u.set("top",p.top+l);break;case"se-alt":u.set("top",p.top+l),u.set("right",P.windowWidth-p.left)}return u}function o(e,t){var o,n,i=e.offset(),s=e.outerWidth(),r=e.outerHeight();switch(t){case"n":o=i.left+s/2,n=i.top;break;case"e":o=i.left+s,n=i.top+r/2;break;case"s":o=i.left+s/2,n=i.top+r;break;case"w":o=i.left,n=i.top+r/2;break;case"nw":o=i.left,n=i.top;break;case"ne":o=i.left+s,n=i.top;break;case"sw":o=i.left,n=i.top+r;break;case"se":o=i.left+s,n=i.top+r}return{top:n,left:o}}function n(e,t){function o(){d.push(p.matrixTransform(u))}var n,i,s,r,a=e.closest("svg")[0],l=e[0],p=a.createSVGPoint(),c=l.getBBox(),u=l.getScreenCTM(),f=c.width/2,w=c.height/2,d=[],h=["nw","n","ne","e","se","s","sw","w"];if(p.x=c.x,p.y=c.y,o(),p.x+=f,o(),p.x+=f,o(),p.y+=w,o(),p.y+=w,o(),p.x-=f,o(),p.x-=f,o(),p.y-=w,o(),d[0].y!==d[1].y||d[0].x!==d[7].x)for(i=Math.atan2(u.b,u.a)*O,s=Math.ceil((i%360-22.5)/45),1>s&&(s+=8);s--;)h.push(h.shift());for(r=0;r<d.length;r++)if(h[r]===t){n=d[r];break}return{top:n.y+P.scrollTop,left:n.x+P.scrollLeft}}this.compute=e}function i(o){function i(e){e.data(v,!0),O.queue(function(t){s(e),t()})}function s(e){var t;if(e.data(v)){if(P.isTipOpen)return P.isClosing||r(P.activeHover),O.delay(100).queue(function(t){s(e),t()}),void 0;e.trigger("powerTipPreRender"),t=p(e),t&&(O.empty().append(t),e.trigger("powerTipRender"),P.activeHover=e,P.isTipOpen=!0,O.data(g,o.mouseOnToPopup),o.followMouse?a():(b(e),P.isFixedTipOpen=!0),O.fadeIn(o.fadeInTime,function(){P.desyncTimeout||(P.desyncTimeout=setInterval(H,500)),e.trigger("powerTipOpen")}))}}function r(e){P.isClosing=!0,P.activeHover=null,P.isTipOpen=!1,P.desyncTimeout=clearInterval(P.desyncTimeout),e.data(v,!1),e.data(m,!1),O.fadeOut(o.fadeOutTime,function(){var n=new t;P.isClosing=!1,P.isFixedTipOpen=!1,O.removeClass(),n.set("top",P.currentY+o.offset),n.set("left",P.currentX+o.offset),O.css(n),e.trigger("powerTipClose")})}function a(){if(!P.isFixedTipOpen&&(P.isTipOpen||P.tipOpenImminent&&O.data(T))){var e,n,i=O.outerWidth(),s=O.outerHeight(),r=new t;r.set("top",P.currentY+o.offset),r.set("left",P.currentX+o.offset),e=c(r,i,s),e!==I.none&&(n=u(e),1===n?e===I.right?r.set("left",P.windowWidth-i):e===I.bottom&&r.set("top",P.scrollTop+P.windowHeight-s):(r.set("left",P.currentX-i-o.offset),r.set("top",P.currentY-s-o.offset))),O.css(r)}}function b(t){var n,i;o.smartPlacement?(n=e.fn.powerTip.smartPlacementLists[o.placement],e.each(n,function(e,o){var n=c(y(t,o),O.outerWidth(),O.outerHeight());return i=o,n===I.none?!1:void 0})):(y(t,o.placement),i=o.placement),O.addClass(i)}function y(e,n){var i,s,r=0,a=new t;a.set("top",0),a.set("left",0),O.css(a);do i=O.outerWidth(),s=O.outerHeight(),a=k.compute(e,n,i,s,o.offset),O.css(a);while(++r<=5&&(i!==O.outerWidth()||s!==O.outerHeight()));return a}function H(){var e=!1;!P.isTipOpen||P.isClosing||P.delayInProgress||(P.activeHover.data(v)===!1||P.activeHover.is(":disabled")?e=!0:l(P.activeHover)||P.activeHover.is(":focus")||P.activeHover.data(m)||(O.data(g)?l(O)||(e=!0):e=!0),e&&r(P.activeHover))}var k=new n,O=e("#"+o.popupId);0===O.length&&(O=e("<div/>",{id:o.popupId}),0===d.length&&(d=e("body")),d.append(O)),o.followMouse&&(O.data(T)||(f.on("mousemove",a),w.on("scroll",a),O.data(T,!0))),o.mouseOnToPopup&&O.on({mouseenter:function(){O.data(g)&&P.activeHover&&P.activeHover.data(h).cancel()},mouseleave:function(){P.activeHover&&P.activeHover.data(h).hide()}}),this.showTip=i,this.hideTip=r,this.resetPosition=b}function s(e){return window.SVGElement&&e[0]instanceof SVGElement}function r(){P.mouseTrackingActive||(P.mouseTrackingActive=!0,e(function(){P.scrollLeft=w.scrollLeft(),P.scrollTop=w.scrollTop(),P.windowWidth=w.width(),P.windowHeight=w.height()}),f.on("mousemove",a),w.on({resize:function(){P.windowWidth=w.width(),P.windowHeight=w.height()},scroll:function(){var e=w.scrollLeft(),t=w.scrollTop();e!==P.scrollLeft&&(P.currentX+=e-P.scrollLeft,P.scrollLeft=e),t!==P.scrollTop&&(P.currentY+=t-P.scrollTop,P.scrollTop=t)}}))}function a(e){P.currentX=e.pageX,P.currentY=e.pageY}function l(e){var t=e.offset(),o=e[0].getBoundingClientRect(),n=o.right-o.left,i=o.bottom-o.top;return P.currentX>=t.left&&P.currentX<=t.left+n&&P.currentY>=t.top&&P.currentY<=t.top+i}function p(t){var o,n,i=t.data(y),s=t.data(H),r=t.data(k);return i?(e.isFunction(i)&&(i=i.call(t[0])),n=i):s?(e.isFunction(s)&&(s=s.call(t[0])),s.length>0&&(n=s.clone(!0,!0))):r&&(o=e("#"+r),o.length>0&&(n=o.html())),n}function c(e,t,o){var n=P.scrollTop,i=P.scrollLeft,s=n+P.windowHeight,r=i+P.windowWidth,a=I.none;return(e.top<n||Math.abs(e.bottom-P.windowHeight)-o<n)&&(a|=I.top),(e.top+o>s||Math.abs(e.bottom-P.windowHeight)>s)&&(a|=I.bottom),(e.left<i||e.right+t>r)&&(a|=I.left),(e.left+t>r||e.right<i)&&(a|=I.right),a}function u(e){for(var t=0;e;)e&=e-1,t++;return t}var f=e(document),w=e(window),d=e("body"),h="displayController",v="hasActiveHover",m="forcedOpen",T="hasMouseMove",g="mouseOnToPopup",b="originalTitle",y="powertip",H="powertipjq",k="powertiptarget",O=180/Math.PI,P={isTipOpen:!1,isFixedTipOpen:!1,isClosing:!1,tipOpenImminent:!1,activeHover:null,currentX:0,currentY:0,previousX:0,previousY:0,desyncTimeout:null,mouseTrackingActive:!1,delayInProgress:!1,windowWidth:0,windowHeight:0,scrollTop:0,scrollLeft:0},I={none:0,top:1,bottom:2,left:4,right:8};e.fn.powerTip=function(t,n){if(!this.length)return this;if("string"===e.type(t)&&e.powerTip[t])return e.powerTip[t].call(this,this,n);var s=e.extend({},e.fn.powerTip.defaults,t),a=new i(s);return r(),this.each(function(){var t,n=e(this),i=n.data(y),r=n.data(H),l=n.data(k);n.data(h)&&e.powerTip.destroy(n),t=n.attr("title"),i||l||r||!t||(n.data(y,t),n.data(b,t),n.removeAttr("title")),n.data(h,new o(n,s,a))}),s.manual||this.on({"mouseenter.powertip":function(t){e.powerTip.show(this,t)},"mouseleave.powertip":function(){e.powerTip.hide(this)},"focus.powertip":function(){e.powerTip.show(this)},"blur.powertip":function(){e.powerTip.hide(this,!0)},"keydown.powertip":function(t){27===t.keyCode&&e.powerTip.hide(this,!0)}}),this},e.fn.powerTip.defaults={fadeInTime:200,fadeOutTime:100,followMouse:!1,popupId:"powerTip",intentSensitivity:7,intentPollInterval:100,closeDelay:100,placement:"n",smartPlacement:!1,offset:10,mouseOnToPopup:!1,manual:!1},e.fn.powerTip.smartPlacementLists={n:["n","ne","nw","s"],e:["e","ne","se","w","nw","sw","n","s","e"],s:["s","se","sw","n"],w:["w","nw","sw","e","ne","se","n","s","w"],nw:["nw","w","sw","n","s","se","nw"],ne:["ne","e","se","n","s","sw","ne"],sw:["sw","w","nw","s","n","ne","sw"],se:["se","e","ne","s","n","nw","se"],"nw-alt":["nw-alt","n","ne-alt","sw-alt","s","se-alt","w","e"],"ne-alt":["ne-alt","n","nw-alt","se-alt","s","sw-alt","e","w"],"sw-alt":["sw-alt","s","se-alt","nw-alt","n","ne-alt","w","e"],"se-alt":["se-alt","s","sw-alt","ne-alt","n","nw-alt","e","w"]},e.powerTip={show:function(t,o){return o?(a(o),P.previousX=o.pageX,P.previousY=o.pageY,e(t).data(h).show()):e(t).first().data(h).show(!0,!0),t},reposition:function(t){return e(t).first().data(h).resetPosition(),t},hide:function(t,o){return t?e(t).first().data(h).hide(o):P.activeHover&&P.activeHover.data(h).hide(!0),t},destroy:function(t){return e(t).off(".powertip").each(function(){var t=e(this),o=[b,h,v,m];t.data(b)&&(t.attr("title",t.data(b)),o.push(y)),t.removeData(o)}),t}},e.powerTip.showTip=e.powerTip.show,e.powerTip.closeTip=e.powerTip.hide});
/* base-view.coffee */
(function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t=function(t){function n(){return this.elem2model=i(this.elem2model,this),this.link2elem=i(this.link2elem,this),this.cid2elem=i(this.cid2elem,this),this.mouseOut=i(this.mouseOut,this),this.mouseIn=i(this.mouseIn,this),this.getItem=i(this.getItem,this),this.initialize=i(this.initialize,this),this.clear=i(this.clear,this),e=n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.clear=function(){return this.$listContent.empty(),this.collection.reset()},n.prototype.initialize=function(){return _.bindAll(this),this.tmpl=_.template($("#view-entry").html()),this.$loading=this.$el.find(".loading"),this.$listContent=this.$el.find(".list-content")},n.prototype.getItem=function(t){var e;for(e=$(t.target);!e.hasClass("list-item");)e=e.parent();return e},n.prototype.mouseIn=function(t){var e;return e=this.getItem(t),e.find(".list-item .pure-button").stop().hide(),e.find(".pure-button").fadeIn("fast")},n.prototype.mouseOut=function(t){var e;return e=this.getItem(t),e.find(".pure-button").stop().hide()},n.prototype.cid2elem=function(t){return this.$el.find(".list-item").filter(function(){return $(this).data("cid")===t})},n.prototype.link2elem=function(t){return this.$el.find(".list-item").filter(function(){return $(this).find("h3 a").attr("href")===t})},n.prototype.elem2model=function(t){return this.collection.get(this.getItem(t).data("cid"))},n}(Backbone.View),this.BaseView=t}).call(this);
/* comment-list.coffee */
(function(){var t,e,n,i,r,o,s={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c=function(t,e){return function(){return t.apply(e,arguments)}};t=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.defaults={user:null,tags:null,timestamp:null,comment:null},e}(Backbone.Model),e=function(e){function n(){return this.parse=c(this.parse,this),r=n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.model=t,n.prototype.url="http://b.hatena.ne.jp/entry/jsonlite/",n.prototype.parse=function(t){var e;if(null!=t)return this.eid=t.eid,this.entryTitle=t.title,this.entryUrl=t.entry_url,function(){var n,i,r,o,s;for(o=null!=(r=t.bookmarks)?r:[],s=[],n=0,i=o.length;i>n;n++)e=o[n],e.comment.length>0&&s.push(e);return s}().reverse()},n}(Backbone.Collection),n=function(t){function n(){return this.render=c(this.render,this),this.showError=c(this.showError,this),this.show=c(this.show,this),this.initialize=c(this.initialize,this),o=n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.el="#comment-list",n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.tmpl=_.template($("#view-comment").html()),this.collection=new e,this.collection.bind("add",this.render)},n.prototype.show=function(t,e){var n=this;return this.clear(),this.$loading.activity({color:"#000"}),this.collection.past=t.get("past"),this.collection.fetch({data:{url:t.get("link")},dataType:"jsonp"}).done(function(t){var i,r;return null==t?n.showError({message:"はてなブックマークAPIエラー"}):0===n.collection.length?n.showError({message:"コメントが1件も登録されていません"}):(r=Math.min(n.collection.length-1,n.collection.past),i=n.$listContent.find(".list-item").eq(r).offset().top-n.$listContent.offset().top,n.$listContent.scrollTop(i),null!=e&&e(n.collection.length)),n.$el.find(".list-control .entry").attr("href",n.collection.entryUrl).text(n.collection.entryTitle),n.$loading.activity(!1)})},n.prototype.showError=function(t){return this.$listContent.html(_.template($("#view-error").html(),t))},n.prototype.render=function(t){var e,n,i;return i=t.get("timestamp"),t.set("comment",t.get("comment").replace(/(http[s]?\:\/\/[\w\+\$\;\?\.\%\,\!\#\~\*\/\:\@\&\\\=\_\-]+)/gi,'<a href="$1" target="_blank">$1</a>')),n={eid:this.collection.eid,userIndex:t.get("user").substr(0,2),relTimestamp:_.niceDate(i),model:t.attributes,date:i.split(/\s/)[0].replace(/\D/g,""),itemClass:this.$listContent.find(".list-item").length>=this.collection.past?"new":""},e=$($.parseHTML(this.tmpl(n))).appendTo(this.$listContent),e.data("cid",t.cid),this},n}(BaseView),this.CommentItem=t,this.CommentList=e,this.CommentView=n}).call(this);
/* entry-list.coffee */
(function(){var t,e,r,i,n,o,s={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a=function(t,e){return function(){return t.apply(e,arguments)}};t=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.defaults={view:"entry",title:null,link:null,description:null,date:null,subject:null,bookmarkcount:0,category:null,favicon:null,host:null},e}(Backbone.Model),e=function(e){function r(){return n=r.__super__.constructor.apply(this,arguments)}return l(r,e),r.prototype.model=t,r}(Backbone.Collection),r=function(r){function i(){return this.showEntry=a(this.showEntry,this),this.resetFilter=a(this.resetFilter,this),this.addFilter=a(this.addFilter,this),this.addWatch=a(this.addWatch,this),this.openEntry=a(this.openEntry,this),this.changeCategory=a(this.changeCategory,this),this.retry=a(this.retry,this),this.showError=a(this.showError,this),this.render=a(this.render,this),this.update=a(this.update,this),this.saveFilter=a(this.saveFilter,this),this.loadFilter=a(this.loadFilter,this),this.initialize=a(this.initialize,this),o=i.__super__.constructor.apply(this,arguments)}return l(i,r),i.prototype.el="#entry-list",i.prototype.saveKey="entryFilter",i.prototype.filter=[],i.prototype.events={"mouseenter .list-item":"mouseIn","mouseleave .list-item":"mouseOut","click .list-control a":"changeCategory","click .error .retry":"retry","click h3 a":"openEntry","click .add-watch":"addWatch","click .add-filter":"addFilter","click .reset-filter":"resetFilter"},i.prototype.initialize=function(t){var r=this;return i.__super__.initialize.call(this,t),this.loadFilter(),this.categoryList={"世の中":"social","政治と経済":"economics","暮らし":"life","学び":"knowledge",テクノロジー:"it",エンタメ:"entertainment",アニメとゲーム:"game",おもしろ:"fun","カテゴリー不明":"unknown"},this.collection=new e,this.collection.bind("add",this.render),this.noCache=!1,setInterval(function(){return r.update()},6e5),this.update()},i.prototype.loadFilter=function(){var t;if("undefined"!=typeof localStorage&&null!==localStorage)return t=localStorage.getItem(this.saveKey),this.filter=JSON.parse(null!=t?t:"[]"),this.filter.length>0?this.$el.find(".reset-filter").show():void 0},i.prototype.saveFilter=function(t){return this.filter.push(t),"undefined"!=typeof localStorage&&null!==localStorage?(localStorage.setItem(this.saveKey,JSON.stringify(this.filter)),this.$el.find(".reset-filter").fadeIn("fast")):void 0},i.prototype.update=function(e){var r,i,n,o,s=this;return null==e&&(e=location.hash),e=e?e.substr(1):"all",this.$el.find(".list-control a").removeClass("current"),this.$el.find(".list-control a[href=#"+e+"]").addClass("current"),this.clear(),this.$loading.activity({color:"#000"}),r=new Date,i=_.sprintf("%04d%02d%02d%02d%02d",r.getFullYear(),r.getMonth()+1,r.getDate(),r.getHours(),Math.floor(r.getMinutes()/5)),this.noCache&&(i+=Math.floor(100*Math.random())),o="http://b.hatena.ne.jp/hotentry",o+="all"===e?"?"+i+"&mode=rss":"/"+e+".rss?"+i,n=new google.feeds.Feed(o),n.setNumEntries(50),n.setResultFormat(google.feeds.Feed.XML_FORMAT),n.load(function(e){var r,i,n,o,l,a,h,c,u,d,f,p;if(s.noCache=!1,e.error)s.showError(e.error);else for(a=$(e.xmlDocument).find("item"),n="dc\\:",c="hatena\\:",u=f=0,p=a.length;p>f;u=++f)h=a[u],r=$(h),0===u&&(i=r.find(""+c+"bookmarkcount").text(),0===(null!=i?i:"").length&&(n="",c="")),l=r.find("link").text(),o=r.find(""+n+"subject").text(),0===(null!=o?o:"").length&&(o="カテゴリー不明"),d=new t({title:r.find("title").text(),link:l,description:r.find("description").text(),date:_.niceDate(r.find(""+n+"date").text()),subject:o,bookmarkcount:r.find(""+c+"bookmarkcount").text(),category:s.categoryList[o],favicon:l.replace(/^(\w+:\/\/[^\/]+)\/.*$/,"$1/favicon.ico"),host:l.replace(/^\w+:\/\/([^\/]+)\/.*$/,"$1")}),s.collection.add(d);return s.$loading.activity(!1)})},i.prototype.render=function(t){var e;return e=$($.parseHTML(this.tmpl(t.attributes))),e.data("cid",t.cid),-1!==$.inArray(t.get("link"),this.filter)&&e.addClass("filtered"),watchView.link2elem(t.get("link")).length>0&&e.hide(),e.appendTo(this.$listContent),e.find("h3 a").powerTip({placement:"e",smartPlacement:!0}),this},i.prototype.showError=function(t){return this.$listContent.html(_.template($("#view-error").html(),t)),this.noCache=!0},i.prototype.retry=function(){return this.update()},i.prototype.changeCategory=function(t){return $(t.target).hasClass("current")?!1:(this.update($(t.target).attr("href")),!0)},i.prototype.openEntry=function(t){var e;return this.$el.find(".list-item").removeClass("selected"),e=this.getItem(t),e.addClass("selected"),!0},i.prototype.addWatch=function(t){var e,r;return r=this.elem2model(t),e=this.cid2elem(r.cid),e.fadeOut("fast",function(){return watchView.addWatch(r)})},i.prototype.addFilter=function(t){var e,r,i=this;return r=this.elem2model(t),e=this.cid2elem(r.cid),e.fadeOut("fast",function(){return e.addClass("filtered"),i.saveFilter(r.get("link"))})},i.prototype.resetFilter=function(t){return this.$listContent.find(".filtered").fadeIn("fast",function(){return $(this).removeClass("filtered")}),"undefined"!=typeof localStorage&&null!==localStorage&&localStorage.removeItem(this.saveKey),$(t.target).fadeOut("fast")},i.prototype.showEntry=function(t){var e;return e=this.link2elem(t),e.fadeIn("fast")},i}(BaseView),this.EntryItem=t,this.EntryList=e,this.EntryView=r}).call(this);
/* jquery.popn-socialbutton.coffee */
(function(){!function(t){"use strict";var o;return o=t,o.fn.popnSocialButton=function(t,n){var r,e,a,u,l,i,c,s,p,h,g,f=this;for(null==n&&(n={}),e=o.extend({},{url:document.location.href,text:o("title").html(),imgDir:"./img",buttonSpace:24,countPosition:{top:32,right:-12},countColor:{text:"#ffffff",bg:"#cc0000",textHover:"#ffffff",bgHover:"#ff6666",border:"#ffffff"},countSize:11},n),e.urlOrg=e.url,e.url=encodeURIComponent(e.url),e.text=encodeURIComponent(e.text),a=44,l=4,r="Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 5.1)",c=/https/.test(document.location.protocol)?"https":"http",s={twitter:{img:"twitter_2x.png",alt:"Twitter Share Button",shareUrl:"https://twitter.com/share?url="+e.url+"&text="+e.text,commentUrl:"https://twitter.com/search/?q="+e.url,countUrl:"http://urls.api.twitter.com/1/urls/count.json?url="+e.url,jsonpFunc:function(t,o){var n;return o(null!=(n=t.count)?n:0)}},facebook:{img:"facebook_2x.png",alt:"Facebook Share Button",shareUrl:"https://www.facebook.com/sharer.php?u="+e.url+"&t="+e.text,countUrl:"https://graph.facebook.com/"+e.url,jsonpFunc:function(t,n){var r,a;return null!=t.shares?n(t.shares):(r=null!=(a=t.likes)?a:0,o.ajax({url:"https://graph.facebook.com/fql?q="+encodeURIComponent("SELECT total_count FROM link_stat WHERE url='"+e.urlOrg+"'"),dataType:"jsonp"}).done(function(t){var o,e,a;return o=null!=(e=null!=(a=t.data[0])?a.total_count:void 0)?e:0,n(r+o)}))}},hatebu:{img:"hatena_bookmark_2x.png",alt:"Hatena Bookmark Share Button",shareUrl:"http://b.hatena.ne.jp/add?mode=confirm&url="+e.url+"&title="+e.text+"&mode=confirm",commentUrl:"http://b.hatena.ne.jp/entry/"+e.urlOrg,countUrl:"http://api.b.st-hatena.com/entry.count?url="+e.url,jsonpFunc:function(t,o){return o(null!=t?t:0)}},gplus:{img:"google+1_2x.png",alt:"Google Plus Share Button",shareUrl:"https://plusone.google.com/share?url="+e.url,countUrl:""+c+"://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent("SELECT content FROM data.headers WHERE url='https://plusone.google.com/_/+1/fastbutton?hl=ja&url="+e.urlOrg+"' and ua='"+r+"'")+"&env=http://datatables.org/alltables.env",jsonpFunc:function(t,o){var n,r,e;return n=0,(null!=(e=t.query)?e.count:void 0)>0&&(r=t.results[0].match(/window\.__SSR = {c: ([\d]+)/),null!=r&&(n=r[1])),o(n)}},github:{img:"github_alt_2x.png",alt:"GitHub Repository",shareUrl:"https://github.com/"+e.githubRepo,commentUrl:"https://github.com/"+e.githubRepo+"/stargazers",countUrl:"https://api.github.com/repos/"+e.githubRepo,jsonpFunc:function(t,o){var n;return o(null!=(n=t.data.watchers)?n:0)}}},p=function(t,n,r){var u,i,c,s,p;return p=o("<div/>").attr({"class":"popn-socialbutton-wrap "+t}).css({"float":"left",position:"relative",width:a,height:a,marginTop:l}),r>0&&p.css({marginLeft:e.buttonSpace}),s=o("<a/>").attr({href:n.shareUrl,"class":"popn-socialbutton-share",target:"_blank"}).css({outline:"none",display:"block",width:"100%",height:"100%"}),c=o("<img/>").attr({src:""+e.imgDir+"/"+n.img,alt:n.alt}).css({border:"none"}),i=n.commentUrl?"a":"span",u=o("<"+i+"/>").attr({"class":"popn-socialbutton-count"}),"a"===i?u.attr({href:n.commentUrl,target:"_blank"}):u.css({cursor:"default"}),u.css(o.extend({},{display:"none",position:"absolute",color:e.countColor.text,backgroundColor:e.countColor.bg,border:"solid 2px "+e.countColor.border,fontSize:e.countSize,textDecoration:"none",outline:"none",fontWeight:"bold",padding:"0 4px",borderRadius:6,boxShadow:"0 1px 2px rgba(0, 0, 0, 0.8)",zIndex:1},e.countPosition)),p.append(s.append(c)).append(u),o(f).append(p),o.ajax({url:n.countUrl,dataType:"jsonp"}).done(function(t){return n.jsonpFunc(t,function(t){return u.show().text(t)})})},u=h=0,g=t.length;g>h;u=++h)i=t[u],null!=s[i]&&p(i,s[i],u);return o(this).height(a+l),o(this).find(".popn-socialbutton-share").click(function(){var t,n;return o(this).parent().hasClass("github")?!0:(n=screen.height/2-180,t=screen.width/2-240,window.open(this.href,"","width=520, height=400, top="+n+", left="+t),!1)}),o(this).find("a.popn-socialbutton-count").mouseenter(function(){return o(this).css({color:e.countColor.textHover,backgroundColor:e.countColor.bgHover})}).mouseleave(function(){return o(this).css({color:e.countColor.text,backgroundColor:e.countColor.bg})}),o(this).find(".popn-socialbutton-wrap").mouseenter(function(){return o(this).stop().animate({marginTop:0},100,"swing")}).mouseleave(function(){return o(this).stop().animate({marginTop:4},100,"swing")})}}(jQuery)}).call(this);
/* main.coffee */
(function(){$(function(){var t,e,o,i;return window.onerror=function(t,e,o){return $("#error .message").text(t),$("#error .at").text("at '"+e+"': "+o),$("#error").slideDown(300),$(window).scrollTop(0)},$("#error .close").click(function(){return $("#error").slideUp()}),__DEBUG__||$("#social-buttons").popnSocialButton(["twitter","facebook","hatebu","gplus","github"],{githubRepo:"ktty1220/bucome-watcher"}),o=$(".list-header").get(0),e=$(".list-control").get(0),t=$("#footer").get(0),i=function(){var i;return i=o.offsetHeight,i+=e.offsetHeight,i+=t.offsetHeight,$(".list-content").height($(window).height()-i)},$(window).bind("resize",i),i(),window.watchView=new WatchView,window.entryView=new EntryView,window.commentView=new CommentView})}).call(this);
/* watch-list.coffee */
(function(){var t,e,i,n,o,r,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,l=function(t,e){function i(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t=function(t){function e(){return this.parse=s(this.parse,this),this.update=s(this.update,this),this.initialize=s(this.initialize,this),n=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.url="http://b.hatena.ne.jp/entry/jsonlite/",e.prototype.initialize=function(){var t=this;return this.timer=setInterval(function(){return t.update()},18e4)},e.prototype.update=function(){var t=this;return $.ajax({url:this.url,data:{url:this.get("link")},dataType:"jsonp"}).done(function(e){var i,n,o;return n=function(){var t,n,o,r,s;for(r=null!=(o=e.bookmarks)?o:[],s=[],t=0,n=r.length;n>t;t++)i=r[t],i.comment.length>0&&s.push(i);return s}().length,o=n-t.get("past"),t.set({newComment:o,bookmarkcount:e.count})})},e.prototype.parse=function(t){return null==t?(alert("エントリー情報を取得できませんでした"),void 0):{view:"watch",title:t.title,link:t.url,description:"※URLを指定して追加したエントリーは本文を取得できません",subject:"URL直接指定",date:"不明",bookmarkcount:t.count,favicon:t.url.replace(/^(\w+:\/\/[^\/]+)\/.*$/,"$1/favicon.ico"),host:t.url.replace(/^\w+:\/\/([^\/]+)\/.*$/,"$1"),newComment:0,past:0}},e}(EntryItem),e=function(e){function i(){return o=i.__super__.constructor.apply(this,arguments)}return l(i,e),i.prototype.model=t,i}(EntryList),i=function(i){function n(){return this.showComment=s(this.showComment,this),this.removeItem=s(this.removeItem,this),this.clear=s(this.clear,this),this.render=s(this.render,this),this.update=s(this.update,this),this.addWatch=s(this.addWatch,this),this.addUrl=s(this.addUrl,this),this.saveCollection=s(this.saveCollection,this),this.loadCollection=s(this.loadCollection,this),this.initialize=s(this.initialize,this),r=n.__super__.constructor.apply(this,arguments)}return l(n,i),n.prototype.el="#watch-list",n.prototype.saveKey="watchList",n.prototype.events={"mouseenter .list-item":"mouseIn","mouseleave .list-item":"mouseOut","click .add-url":"addUrl","click .clear":"clear","click .remove":"removeItem","click .comment":"showComment"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.collection=new e,this.collection.bind("add",this.render),this.collection.bind("change",this.update),this.init=!0,this.loadCollection(),this.init=!1},n.prototype.loadCollection=function(){var t,e,i,n,o,r;if("undefined"!=typeof localStorage&&null!==localStorage&&(e=localStorage.getItem(this.saveKey),null!=e)){for(i=JSON.parse(e),r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(this.addWatch(t));return r}},n.prototype.saveCollection=function(){var t,e,i,n,o;if("undefined"!=typeof localStorage&&null!==localStorage&&!this.init){for(e=[],o=this.collection.models,i=0,n=o.length;n>i;i++)t=o[i],e.push({attributes:t.attributes});return localStorage.setItem(this.saveKey,JSON.stringify(e))}},n.prototype.addUrl=function(){var e,i,n,o=this;return i=_.trim(null!=(n=prompt("URLを入力してください。"))?n:""),i.length>0?(e=new t,e.fetch({data:{url:i},dataType:"jsonp"}).done(function(t){return null!=t?o.addWatch(e):void 0})):void 0},n.prototype.addWatch=function(e){var i,n,o,r;i=new t,r=e.attributes;for(n in r)o=r[n],i.set(n,o);return i.set("view","watch"),null==e.attributes.newComment&&i.set("newComment",0),null==e.attributes.past&&i.set("past",0),this.collection.add(i),this.saveCollection(),i.update()},n.prototype.update=function(t){var e,i;return i=this.cid2elem(t.cid),e=t.get("newComment"),i.find(".bookmarkcount .count").text(t.get("bookmarkcount")),e>0&&(i.find(".new-comment").text(e),i.find(".new-comment").show()),this.saveCollection()},n.prototype.render=function(t){var e;return e=$($.parseHTML(this.tmpl(t.attributes))).appendTo(this.$listContent),e.data("cid",t.cid),e.find("h3 a").powerTip({placement:"e",smartPlacement:!0}),this},n.prototype.clear=function(){var t=this;return this.$el.find(".list-item").each(function(e,i){return t.removeItem({target:i})}),"undefined"!=typeof localStorage&&null!==localStorage?localStorage.removeItem(this.saveKey):void 0},n.prototype.removeItem=function(t){var e,i,n,o=this;return n=this.getItem(t),e=n.data("cid"),i=this.collection.get(e),clearInterval(i.timer),this.collection.remove(e),n.fadeOut("fast",function(){return entryView.showEntry(n.find("h3 a").attr("href")),n.remove(),o.saveCollection()})},n.prototype.showComment=function(t){var e,i=this;return e=this.elem2model(t),commentView.show(e,function(n){var o;return null==n&&(n=0),e.set({past:n},{silent:!0}),i.$el.find(".list-item").removeClass("selected"),o=i.getItem(t),o.addClass("selected"),o.find(".new-comment").hide(),i.saveCollection()})},n}(BaseView),this.WatchItem=t,this.WatchList=e,this.WatchView=i}).call(this);
